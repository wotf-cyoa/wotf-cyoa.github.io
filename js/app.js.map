{"version":3,"sources":["app/app.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5GA;AAAA","file":"public/js/app.js","sourcesContent":["var editor = ace.edit('game-rb-editor');\neditor.setTheme('ace/theme/monokai');\neditor.getSession().setFoldStyle('manual');\neditor.getSession().setMode(\"ace/mode/ruby\");\neditor.getSession().setTabSize(2);\neditor.getSession().setUseSoftTabs(true);\neditor.getSession().setUseWrapMode(true);\neditor.setDisplayIndentGuides(false);\neditor.setHighlightActiveLine(true);\neditor.setShowPrintMargin(false);\neditor.setShowInvisibles(true);\neditor.setReadOnly(true);\n\nvar addToTerminal = function(value, type) {\n    var classes = 'outputs outputs-' + type;\n    value = value.replace(/&/g, '&amp;')\n                 .replace(/>/g, '&gt;')\n                 .replace(/</g, '&lt;')\n                 .replace(/\"/g, '&quot;')\n                 .replace(/'/g, '&apos;')\n                 .replace(/\\n/g, '<br>');\n    terminalOutputs.innerHTML += '<p class=\"' + classes + '\">' + value + '</p>';\n    terminalInput.scrollIntoView();\n};\n\nvar handleterminalInput = function(event) {\n    var key = event.which || event.keyCode;\n    if (key == 13) {\n        event.preventDefault();\n        socket.emit('terminalInput', { input: terminalInput.value });\n        addToTerminal(terminalInput.value, 'input');\n        terminalInput.value = '';\n    }\n};\n\nvar handleCodeBuild = function() {\n    var currentFileContent = editor.getValue();\n    addToTerminal('Build started...', 'status');\n    socket.emit('codeBuild', { fileContent: currentFileContent });\n};\n\nvar handleHashChange = function(event) {\n    if (window.location.hash !== '#' + localStorage.getItem('userid')) {\n        window.location.reload();\n    }\n};\n\nvar userid = window.location.hash.replace(/#/, '') || localStorage.getItem('userid') || '';\nlocalStorage.setItem('userid', userid);\n\n// Set socket URL based on environment\nvar socketURL = 'http://wotf-cyoa.herokuapp.com:80/ruby';\nif (window.location.origin === 'http://localhost:3333')\n    socketURL = 'http://localhost:8888/ruby';\n\nvar socket = io(socketURL),\n    terminal = document.getElementById('terminal'),\n    terminalOutputs = document.getElementById('terminal-outputs'),\n    terminalInput = document.getElementById('terminal-input'),\n    sourceActionBuild = document.getElementById('source-action-build');\n\nterminal.addEventListener('click', function(e) { terminalInput.focus() }, false);\n\nsocket.on('connect', function() {\n    socket.emit('reportUserid', {\n      userid: localStorage.getItem('userid'),\n      authid: localStorage.getItem('authid')\n    });\n\n    addToTerminal('Server connected.', 'status');\n    terminalInput.addEventListener('keypress', handleterminalInput, false);\n    sourceActionBuild.addEventListener('click', handleCodeBuild, false);\n    editor.setReadOnly(false);\n});\n\nsocket.on('disconnect', function() {\n    addToTerminal('Server disconnected.', 'error');\n    terminalInput.removeEventListener('keypress', handleterminalInput, false);\n    sourceActionBuild.removeEventListener('click', handleCodeBuild, false);\n    editor.setReadOnly(true);\n});\n\nsocket.on('ready', function(data) {\n    addToTerminal(data.output, 'status');\n    editor.setValue(data.fileContent);\n    editor.gotoLine(0);\n});\n\nsocket.on('confirmUserid', function(data) {\n    localStorage.setItem('userid', data.userid);\n    localStorage.setItem('authid', data.authid);\n    if (window.location.hash !== '#' + data.userid) {\n        window.location.replace('#' + data.userid);\n    }\n    window.addEventListener('hashchange', handleHashChange, false);\n});\n\nsocket.on('terminalOutput', function(data) {\n    addToTerminal(data.output, 'output');\n});\n\nsocket.on('terminalError', function(data) {\n    addToTerminal(data.output, 'error');\n});\n\nsocket.on('buildStatus', function(data) {\n    addToTerminal(data.output, 'status');\n});\n"]}